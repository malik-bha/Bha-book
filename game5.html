<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium CoinFlip - Jalwa Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #020617; --card: #0f172a; --gold: #fbbf24; 
            --green: #10b981; --red: #ef4444; --blue: #3b82f6;
            --btn-grad-green: linear-gradient(180deg, #10b981 0%, #059669 100%);
            --btn-grad-blue: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
        }
        body { background: var(--bg); color: white; font-family: 'Rajdhani', sans-serif; margin: 0; overflow: hidden; }
        .app { width: 100%; max-width: 400px; margin: auto; height: 100vh; display: flex; flex-direction: column; }
        
        /* Header */
        .header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo { font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 18px; color: var(--gold); text-shadow: 0 0 10px rgba(251, 191, 36, 0.3); }
        .bal-box { background: rgba(255,255,255,0.03); padding: 6px 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); font-weight: 700; color: var(--green); }

        /* Game Area */
        .game-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 30px; }
        
        /* Coin */
        .coin-wrapper { width: 150px; height: 150px; perspective: 1000px; }
        .coin { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 2s cubic-bezier(0.15, 0.85, 0.35, 1.05); }
        .coin div { position: absolute; width: 100%; height: 100%; border-radius: 50%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border: 4px solid #92400e; font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 20px; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .heads { background: radial-gradient(circle, #fbbf24, #d97706); color: #451a03; }
        .tails { background: radial-gradient(circle, #fcd34d, #b45309); color: #451a03; transform: rotateY(180deg); }

        /* Bet Section Container */
        .bet-panel { width: 90%; background: var(--card); border-radius: 24px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }

        /* Chips Design */
        .chip-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .chip { 
            width: 45px; height: 45px; border-radius: 50%; border: 2px dashed rgba(255,255,255,0.2); 
            display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700;
            cursor: pointer; transition: 0.2s; background: rgba(0,0,0,0.2);
        }
        .chip.active { border: 2px solid var(--gold); color: var(--gold); box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); transform: scale(1.1); background: rgba(251, 191, 36, 0.1); }

        /* Stepper x2 1/2 */
        .stepper-row { display: flex; gap: 8px; margin-bottom: 15px; }
        .step-btn { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 10px; border-radius: 12px; font-size: 14px; font-weight: 700; cursor: pointer; }
        .step-btn:hover { background: rgba(255,255,255,0.1); }

        /* Display Stake */
        .stake-box { text-align: center; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 12px; }
        .stake-box label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
        .stake-box div { font-size: 24px; font-weight: 700; color: #fff; margin-top: 2px; }

        /* Play Buttons Design */
        .footer-controls { padding: 20px; background: #020617; border-top: 1px solid rgba(255,255,255,0.05); }
        .play-grid { display: flex; gap: 15px; }
        .btn-3d { 
            flex: 1; position: relative; height: 70px; border: none; border-radius: 18px; 
            cursor: pointer; transition: all 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn-heads { background: #065f46; box-shadow: 0 6px 0 #047857, 0 10px 20px rgba(0,0,0,0.4); }
        .btn-tails { background: #1e40af; box-shadow: 0 6px 0 #1d4ed8, 0 10px 20px rgba(0,0,0,0.4); }
        
        .btn-3d:active { transform: translateY(4px); box-shadow: 0 2px 0 #000; }
        .btn-3d b { font-size: 18px; color: white; letter-spacing: 1px; }
        .btn-3d span { font-size: 10px; color: rgba(255,255,255,0.7); font-weight: 600; margin-top: 2px; }

        /* Popups */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal { width: 80%; background: var(--card); padding: 40px 20px; border-radius: 30px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .modal h1 { font-family: 'Orbitron', sans-serif; font-size: 36px; margin: 0; }
        .modal button { width: 100%; padding: 15px; margin-top: 30px; border-radius: 15px; border: none; background: #fff; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>

<div class="app">
    <div class="header">
        <div class="logo">COIN FLIP</div>
        <div class="bal-box">₹ <span id="bal-text">0.00</span></div>
    </div>

    <div class="game-area">
        <div class="coin-wrapper">
            <div id="coin" class="coin">
                <div class="heads">HEADS</div>
                <div class="tails">TAILS</div>
            </div>
        </div>

        <div class="bet-panel">
            <div class="chip-row">
                <div class="chip active" onclick="setChip(10, this)">10</div>
                <div class="chip" onclick="setChip(50, this)">50</div>
                <div class="chip" onclick="setChip(100, this)">100</div>
                <div class="chip" onclick="setChip(500, this)">500</div>
                <div class="chip" onclick="setChip(1000, this)">1K</div>
            </div>

            <div class="stepper-row">
                <button class="step-btn" onclick="adjustBet('1/2')">1/2</button>
                <button class="step-btn" onclick="adjustBet('x2')">2X</button>
            </div>

            <div class="stake-box">
                <label>Bet Amount</label>
                <div id="bet-display">₹10.00</div>
            </div>
        </div>
    </div>

    <div class="footer-controls">
        <div class="play-grid">
            <button class="btn-3d btn-heads" onclick="play('HEAD')">
                <b>HEADS</b>
                <span>WIN 1.94x</span>
            </button>
            <button class="btn-3d btn-tails" onclick="play('TAIL')">
                <b>TAILS</b>
                <span>WIN 1.94x</span>
            </button>
        </div>
    </div>
</div>

<div id="modal" class="overlay">
    <div class="modal">
        <h1 id="res-title">WINNER!</h1>
        <div id="res-amt" style="font-size: 28px; margin: 15px 0; font-weight: 700;">₹0.00</div>
        <button onclick="closeModal()">CONTINUE</button>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzq-CozHl9G9E4FN3aoFXa2Zq8uT5kX7WOpvMgwgBYzOe-ZpqSA_HjBb85AHWi7jwg/exec";
    const mobile = localStorage.getItem("mobile");
    let balance = 0, bet = 10, running = false;

    async function getBal() {
        if(!mobile) return;
        const r = await fetch(API_URL, { method: "POST", body: JSON.stringify({ type: "getUser", mobile: mobile }) });
        const d = await r.json();
        balance = parseFloat(d.balance);
        document.getElementById('bal-text').innerText = balance.toFixed(2);
    }

    function setChip(amt, el) {
        if(running) return;
        bet = amt;
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('bet-display').innerText = "₹" + bet.toFixed(2);
    }

    function adjustBet(type) {
        if(running) return;
        if(type === '1/2') bet = Math.max(10, bet / 2);
        else bet = Math.min(balance, bet * 2);
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        document.getElementById('bet-display').innerText = "₹" + bet.toFixed(2);
    }

    function play(choice) {
        if(running || balance < bet) return;
        running = true;
        balance -= bet;
        document.getElementById('bal-text').innerText = balance.toFixed(2);
        fetch(API_URL, { method: "POST", body: JSON.stringify({ type: "game", mobile: mobile, change: -bet }) });

        const result = Math.random() < 0.5 ? 'HEAD' : 'TAIL';
        const coin = document.getElementById('coin');
        coin.style.transition = 'none';
        coin.style.transform = 'rotateY(0)';
        
        setTimeout(() => {
            coin.style.transition = 'transform 2s cubic-bezier(0.1, 0.9, 0.1, 1.1)';
            const spin = result === 'HEAD' ? 1800 : 1980;
            coin.style.transform = `rotateY(${spin}deg)`;
        }, 50);

        setTimeout(() => {
            running = false;
            let won = (choice === result);
            let winAmt = won ? bet * 1.94 : 0;
            
            document.getElementById('res-title').innerText = won ? "WINNER!" : "LOST";
            document.getElementById('res-title').style.color = won ? "var(--green)" : "var(--red)";
            document.getElementById('res-amt').innerText = "₹" + winAmt.toFixed(2);
            document.getElementById('modal').style.display = 'flex';

            if(won) fetch(API_URL, { method: "POST", body: JSON.stringify({ type: "game", mobile: mobile, change: winAmt }) }).then(getBal);
            else getBal();
        }, 2200);
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    window.onload = getBal;
</script>
</body>
</html>
