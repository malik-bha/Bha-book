<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Withdraw</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');
*{box-sizing:border-box}

body{
 margin:0;
 background:#0b0f1a;
 font-family:Poppins;
 color:#fff;
}

/* HEADER */
.header{
 background:#0f172a;
 padding:15px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 box-shadow:0 4px 20px rgba(0,255,200,.2);
}
.header a{color:#00ffd5;text-decoration:none;font-size:14px}

/* CARD */
.card{
 margin:18px;
 padding:20px;
 border-radius:22px;
 background:linear-gradient(135deg,#020024,#090979,#00d4ff);
 box-shadow:0 0 25px rgba(0,212,255,.4);
}

/* BALANCE */
.balance{font-size:32px;font-weight:700}

/* FORM */
.form{
 margin:18px;
 padding:20px;
 border-radius:20px;
 background:#121826;
 box-shadow:0 0 15px rgba(0,255,200,.15);
}

/* INPUT */
input{
 width:100%;
 padding:14px;
 margin-top:14px;
 background:#0f172a;
 border:1px solid #1f2a44;
 color:#fff;
 border-radius:12px;
}

/* BUTTON */
button{
 width:100%;
 margin-top:20px;
 padding:15px;
 background:linear-gradient(135deg,#00ffd5,#00bfa6);
 color:#000;
 font-weight:700;
 border:none;
 border-radius:14px;
 cursor:pointer;
 position:relative;
 overflow:hidden;
}

/* RIPPLE */
button span{
 position:absolute;
 border-radius:50%;
 transform:scale(0);
 animation:ripple .6s linear;
 background:rgba(255,255,255,.6);
}
@keyframes ripple{
 to{transform:scale(4);opacity:0}
}

/* LOADER */
.loader{
 display:none;
 margin-top:15px;
 text-align:center;
}

/* SPINNER */
.spinner{
 width:32px;height:32px;
 border:3px solid #00ffd5;
 border-top:3px solid transparent;
 border-radius:50%;
 animation:spin 1s linear infinite;
 margin:auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}

/* MESSAGE */
.msg{margin-top:12px;font-size:14px}
.success{color:#00ffd5}
.error{color:#ff6a6a}

.small{
 font-size:12px;
 color:#00ffd5;
 margin-top:8px;
 cursor:pointer;
}

.withdraw-time{
 margin-top:10px;
 font-size:12px;
 text-align:center;
 color:#00ffd5;
 opacity:.9;
}

</style>
</head>

<body>

<div class="header">
 <div>Withdraw</div>
 <a href="withdraw-history.html">History</a>
</div>

<div class="card">
 <div>Wallet Balance</div>
 <div class="balance" id="bal">‚Çπ---</div>
</div>

<div class="form">
 <input id="upi" placeholder="Enter UPI ID">
 <div class="small" onclick="changeUPI()">Change UPI</div>

 <input id="amount" type="number" placeholder="Enter Amount">

 <button onclick="withdraw(event)">Withdraw Now</button>

<div class="withdraw-time">
 Withdraw Time: <b>3:00 PM ‚Äì 4:00 PM</b>
</div>

 <div class="loader" id="loader">
   <div class="spinner"></div>
 </div>

 <div class="msg" id="msg"></div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbxAwTCBQtTl16htSS2RbWuEA2nc9LvIzZzVB7-OJWe87coZUwVJQ7DWyLZb70P0_LKR/exec";
function isWithdrawTimeAllowed(){
  const now = new Date();
  const hours = now.getHours();

  // 3:00 PM = 15:00
  // 4:00 PM = 16:00
  if(hours === 15){
    return true;
  }
  return false;
}
const mobile = localStorage.getItem("mobile");

if(!mobile) location.href="index.html";

let balance=0;

/* LOAD BALANCE */
fetch(API_URL,{
 method:"POST",
 body:JSON.stringify({type:"getUser",mobile})
})
.then(r=>r.json())
.then(d=>{
 balance=Number(d.balance||0);
 bal.innerText="‚Çπ"+balance;
});

/* SAVE UPI ONCE */
let savedUPI=localStorage.getItem("withdraw_upi")||"";
if(savedUPI) upi.value=savedUPI;

/* CHANGE UPI */
function changeUPI(){
 let n=prompt("Enter new UPI ID",upi.value);
 if(n){
  upi.value=n;
  localStorage.setItem("withdraw_upi",n);
 }
}

/* WITHDRAW */
function withdraw(e) {
 msg.innerHTML = ""; // ‚Üê €å€Å line add ⁄©ÿ±Ÿà (ÿ≥ÿ® ÿ≥€í ÿßŸàŸæÿ±)
 
 const btn = e.currentTarget;
 
 /* TIME CHECK */
 if (!isWithdrawTimeAllowed()) {
  msg.innerHTML = "<div class='error'>Withdraw only allowed between 3:00 PM to 4:00 PM</div>";
  return;
 }
 
 /* ripple */
 const span = document.createElement("span");
 const d = Math.max(btn.clientWidth, btn.clientHeight);
 span.style.width = span.style.height = d + "px";
 span.style.left = e.offsetX - d / 2 + "px";
 span.style.top = e.offsetY - d / 2 + "px";
 btn.appendChild(span);
 setTimeout(() => span.remove(), 600);
 
 const amt = Number(amount.value);
 const upiId = upi.value.trim();
 msg.innerHTML = "";
 
 // ‚úÖ CHECK BALANCE
 if (!upiId || amt <= 0) {
  msg.innerHTML = "<div class='error'>Enter UPI & Amount</div>";
  return;
 }
 
 if (balance <= 0) {
  msg.innerHTML = "<div class='error'>Insufficient balance</div>";
  return;
 }
 
 if (amt > balance) {
  msg.innerHTML = "<div class='error'>Amount exceeds wallet balance</div>";
  return;
 }
 
 /* üî• INSTANT BALANCE CUT */
 balance -= amt;
 bal.innerText = "‚Çπ" + balance;
 
 loader.style.display = "block";
 
 /* SAVE LOCAL HISTORY */
 let history = JSON.parse(localStorage.getItem("withdrawHistory") || "[]");
 history.unshift({
  amount: amt,
  upi: upiId,
  time: new Date().toLocaleString(),
  status: "PENDING"
 });
 localStorage.setItem("withdrawHistory", JSON.stringify(history));
 
 /* SEND TO SHEET */
 fetch(API_URL, {
  method: "POST",
  mode: "no-cors",
  body: JSON.stringify({
   type: "withdraw",
   mobile,
   amount: amt,
   upi: upiId
  })
 });
 
 setTimeout(() => {
  loader.style.display = "none";
  msg.innerHTML = "<div class='success'>Withdraw Request Sent</div>";
  amount.value = "";
 }, 1200);
}
</script>

</body>
</html>